# 零基础入门预测性分析

## 内容简介

本课程首先会介绍数据分析的基本概念、机器学习基本概念，通过一些示例了解数据分析和机器学习基础知识，然后以数据分析中的预测性分析为例，讲述预测分析基础知识。接下来，根据不同预测目的，通过案例讲述分类、聚类、关联分析中典型的算法原理与应用场景，并展示代码实践案例，让学员们通过通俗易懂的案例来学习算法原理，掌握实际场景下的算法落地方法。具体的，如下图红色框出的部分。
![数据分析是个层次](https://ae01.alicdn.com/kf/Uc10ea14b7a524bc3a6b9ec4b549de932K.jpg)

## 1. 数据分析基本概念

### 1.1 数据分析定义

**数据分析**：从海量的数据中提取和挖掘出对企业有价值的规律和趋势，为企业决策提供支持。通俗来说，数据分析就是从数据中挖掘出有用的信息来使企业运营得更好，具体表现为增加收入、降低成本、提升效率、控制风险。
例如淘宝中的商品推荐，通过分析用户历史的浏览、收藏、购物车记录，为用户推荐可能购买的商品，增加用户购买量进而增加收入。银行通过评估用户的各类属性、历史贷款记录预估用户逾期还款概率，控制给用户贷款存在的潜在风险。

### 1.2 数据分析分类

根据数据分析所起的作用，将数据分析分为四个层次，依次为**描述性分析**、**诊断性分析**、**预测性分析**以及**决策性分析**。

- 第一层次是监控现状，告诉业务人员发生了什么，结果是什么；
- 第二层次是诊断问题，当业务产生问题时，我们通过数据分析为什么会发生这类问题，由什么原因导致的；
- 第三层次是预测未来，了解接下来业务会发生什么变化；
- 第四层次是决策支持，确定下一步该做什么，不该做什么。
  ![数据分析是个层次](https://ae01.alicdn.com/kf/Ub90f364fef6a4a53999e291d5de5255dt.jpg)

通过一个简单的例子来讲解四个层次的区别。通过检测城市道路车辆通过的速度可知：

- 当车辆通过的速度低于道路标准最低速度时，则判定为道路拥堵，这一个过程就是**监控现状（描述性分析）**；
- 当某个道路口发生拥堵时，通过分析历史数据，来判定是什么原因导致拥堵，比如节假日、天气、交通事故等，这一过程就是**诊断问题（诊断性分析）**；
- 通过预测道路的交通量及旅行时间，我们可以提前发现可能发生拥堵的道路口，提前进行规划，避免拥堵发生，这一过程就是**预测未来（预测性分析）**；
- 对城市道路建设进行规划时，考虑如何才能得到效益最大化，这一过程就是**决策支持（决策性分析）**。
  ![交通拥堵3](https://ae01.alicdn.com/kf/Ud7bff5168cfc4dd790b7d490107cc866u.jpg)

### 1.3 预测性分析

在讲解预测性分析之前，我们先来看一个案例：
假设你在一家婴儿奶粉企业工作，通过数据发现近两年婴儿奶粉的销售额增长迅速，进一步发展婴儿奶粉销售将是促进销售额进一步增长的方法。而越早发现有婴儿奶粉消费需求的群体，越能赶在竞争对手前获得用户，这时候你该怎么做呢？

A 要求各门店下个季度的婴儿奶粉业绩必须提高100%，然后等待好消息
B 开始漫天打广告，增加知名度
C 让营销部立马开始策划密集促销活动，通过促销带动业绩
D 利用公司积累的会员信息，通过数据预测潜在的有婴儿奶粉需求的会员，开展针对性的营销
![销售额增长](https://ae01.alicdn.com/kf/U24b28e766d3344d5a258ee0f607d7d25Q.jpg)

以上四种方法虽然都可以提升销售额，但不同方法的投入产出比不同。给各门店提高销售业绩目标，门店销售人员加班加点尽力达成目标；打广告和促销活动可以吸引用户购买提升业绩。考虑到购买婴儿奶粉的人群是奶爸奶妈，一个小群体。如果面向全体打广告和搞促销，投入成本高，而带来的业绩提升有可能不明显。那最好的方式是找出有婴儿奶粉需求的群体，然后针对性营销，这种营销方式有个词叫精准营销。

**预测性分析**：通过统计学、**机器学习**模型对数据处理，发现隐藏的信息或预测分析对象的某些未知属性。
预测性分析的目的是挖掘机会，找到数据中隐藏的但直观上无法发现的信息。
预测性分析不能直接对数据进行组合、转换得到信息，而是需要通过统计学、机器学习模型等方法对数据进行处理，从而发掘出隐藏的有价值信息或预测分析对象的某些未知属性。根据预测目的的不同，数据分析可以分为**分类**、**聚类**、**关联分析**以及**离群点检测**。
![挖掘机会](https://ae01.alicdn.com/kf/Ud35fbaa1d380488dac3457a9b6dfe868F.jpg)

## 2.机器学习基本概念

### 2.1机器学习定义

**机器学习**：从有限的观测数据中学习(或“猜测”)出具有一般性的规律，并将这些规律应用到未观测数据样本上的方法。传统上计算机工作是：通过给计算机一串指令，然后它遵照这个指令一步步执行下去，有因果逻辑。机器学习是让计算机利用数据而不是指令来进行各种工作。

可以通过一个案例来辅助理解机器学习是什么。我们经常会采用经验法来思考问题，生活中约会时判断某个人是否会迟到，决定自己是否要按时出发，我们通过之前和他约会时他迟到的次数占比，比如和某个人约会过10次，他迟到的次数是2次，则他按时到的比例是80%，若我能接受的按时到的比例阈值是70%，则我认为这个人这次不会迟到。如果10次约会中有6次是迟到，则按时到的比例为40%，低于能接受的阈值，则认为这个人这次会迟到，我推迟出门。在经验法的思考过程中，我们事实上利用了以往所有相约的数据。因此也可以称之为依据数据做的判断。**依据数据所做的判断跟机器学习的思想根本上是一致的**。

机器学习方法是计算机利用已有的数据(经验)，得出了某种模型(迟到的规律)，并利用此模型达到预测未来(是否迟到)目的的一种方法。
人类在成长、生活过程中积累了很多的历史与经验。人类定期的对这些经验进行“归纳”，获得了生活的“规律”。当人类遇到未知的问题或者需要对未来进行“推测”的时候，便可使用这些“规律”，对未知问题与未来进行“推测”，从而指导自己的当前的生活与工作。

机器学习中的“训练”与“预测”过程可以对应到人类的“归纳”和“推测”过程。通过这样的对应，我们可以发现，机器学习的思想并不复杂，仅仅是对人类在生活中学习成长的一个模拟。由于机器学习不是基于编程形成的结果，因此它的处理过程不是因果的逻辑，而是通过归纳思想得出的相关性结论。
![机器学习对比](https://ae01.alicdn.com/kf/U1ee17fba430d49ee82beb250b1f10a42m.jpg)

### 2.2基础概念

机器学习包含以下基本概念：

1. **数据集(data set)** ：一组记录的集合；
2. **样本 (sample)**：每条记录关于一个事件或对象的描述；
3. **特征 (feature)**： 反映事件或对象在某方面的表现或性质的事项；
4. **训练样本 (training sample)**：每个样本；
5. **训练集(training set)**：训练样本组成的集合；
6. **标记 (label)**： 这里关于示例结果的信息；
7. **样例 (example)**：拥有了标记信息的示例；
8. **测试样本 (testing sample)**：被预测的样本；

![数据表](https://ae01.alicdn.com/kf/U3221d25081d64ada8b8b2686885075ac3.jpg)

### 2.3 机器学习分类

**监督学习**：数据集是有标签的，就是说对于给出的样本我们是知道答案的。监督学习可分为**分类问题**和**回归问题**。
**非监督学习**：数据集是完全没有标签的，主要的依据是相似的样本在数据空间中一般距离是相近的，这样就能通过距离的计算把样本分类，因此不需要label。
![分类和聚类](https://ae01.alicdn.com/kf/Ub4a414ea4b954bd2858c2f96e50a6ed1e.jpg)

可以通过一张图来形象地理**解监督学习**与**无监督学习**区别。如图所示，左边的水果有苹果、橙子、雪梨，把三种水果放在一个篮子里，需要按类别进行分开，这就是监督学习。右边所示的水果加上了表情包，我们并不知道这些水果的名字，事先没有标签，需要根据外形特点来把相似的水果放在一起，这就是无监督学习。
![机器学习分类](https://ae01.alicdn.com/kf/Uc13c9eeb19ee45cc9d16f9b531ca09a5K.jpg)

让我们做一个快速测验，确定给定的场景是使用监督还是非监督学习，具体如下：

1. 场景 1: 手机APP从标签照片相册中识别出风景照片和美食照片
2. 场景 2: 视频网站根据某人过去的电影选择推荐新电影
3. 场景 3: 分析可疑交易的银行数据并标记欺诈交易

以上题目答案：

1. 场景 1: 手机APP从标签照片相册中识别出风景照片和美食照片: 是监督学习。手机APP通过使用标记的照片来识别风景和美食。因此，标记的照片成为图片的标签，我们知道当机器从标记的数据中学习时，它是监督学习。
2. 场景 2: 根据某人过去的电影选择推荐新电影: 是监督学习。该模型是在预先存在的标签 (电影类型) 上训练分类器。一般视频网站会收集用户已经喜欢的电影,根据用户的喜好评估功能，然后根据类似功能推荐新电影。
3. 场景 3: 分析可疑交易的银行数据并标记欺诈交易: 是非监督学习。在这种情况下，可疑交易没有定义，因此没有 “欺诈” 和 “非欺诈” 的标签。该模型试图通过查看异常交易来识别异常值，并将其标记为 “欺诈”。

## 3. 分类分析

分类问题在我们生活中非常常见，如购物APP中对众多商品按类别进行分类，方便用户查找。
![购物分类界面](https://ae01.alicdn.com/kf/U9ed5c526c8a84147b67d83efaac0a63d3.jpg)

**分类分析**：简化认识、降低管理成本、提升管理效率的重要手段。
分类算法：**K最近邻算法（KNN）**、决策树、支持向量机

### 3.1KNN

KNN算法的思想很简单，用一句通俗的话来说叫“近朱者赤，近墨者黑”，由你的邻居来推断出你的类别。接下来，通过一个形象的例子来了解KNN算法的思想。现在有橙子和柚子两种水果，一般而言，柚子比橙子个头大、颜色更黄，如下图所示。
![橙子柚子1 图标](https://ae01.alicdn.com/kf/U6be6a434444245f79f2d9762e026dd02f.jpg)

突然之间，来了一个神秘的水果，这个水果大小介于柚子和橙子之间，颜色也介于橙色和黄色之间。
![橙子柚子2 图标](https://ae01.alicdn.com/kf/Ue792004094194ad2a82040eae851fcc0o.jpg)
如何判断这个水果是橙子还是柚子呢？一种办法是看它的邻居。我们通过找出离他最近的三个邻居，发现在这三个邻居中，橙子的数量比柚子多。少数服从多数，这个水果很可能是橙子。
![橙子柚子3 图标](https://ae01.alicdn.com/kf/U3afa9d5c24474353a976d252e1414d13R.jpg)
如果你了解了刚才区分一个水果是橙子还是柚子的思想，就掌握了KNN最近邻算法进行分类的算法。梳理下我们刚才使用KNN算法进行分类的流程：
![KNN步骤 图标](https://ae01.alicdn.com/kf/Uc85fd1096aa848caa5f5e1f8a268a6678.jpg)

总结KNN的算法步骤，可以分为三步：
1.算距离：给定测试对象(神秘水果)，计算它和训练集中（已知的橙子和柚子）每个对象的距离。
如何衡量距离的远近呢？常见的距离衡量有欧式距离，具体计算公式如下：

d(i,j)=(xi1−xj1)2+(xi2−xj2)2+...+(xin−xjn)2


假设A橙子颜色深度为0.2，大小为0.3；B柚子颜色深度为0.6，大小为0.8，则A与B的欧式距离为：

d=(0.2−0.6)2+(0.3−0.8)2=0.64


2.找邻居：圈定距离最近的k个训练对象，作为测试对象(神秘水果)的近邻;
3.做分类：根据这k个近邻归属的主要类别(橙子和柚子)，来对测试对象(神秘水果)分类



![KNN-Classification](https://ae01.alicdn.com/kf/Ua9b31cc4e31b4480a374e3683fa35089M.jpg)

### 3.2KNN算法应用场景

**风控领域**：申请贷款是否能按时还款的判断，通过分析某个人的登记信息与相似信息的人在过去有申请贷款记录及还款记录的信息进行判断。
![KNN应用](https://ae01.alicdn.com/kf/Ue6007b088f5a493697abf6180f1bff10B.jpg)

### 3.3KNN算法实践

## 4.聚类分析

**聚类分析**：仅依据数据中发现的描述对象的特征，将数据进行分组。其目标是，组内的对象相互间是相似的，不同组之间的对象是不同的。
![聚类分析定义](https://ae01.alicdn.com/kf/Uc5ebfa2fd8fc4127bee874def32e5a93u.jpg)

聚类算法：**Kmeans算法**、DBSCAN算法

### 4.1 Kmeans算法

**Kmeans**算法是聚类中最常见的方法。在使用Kmeans过程中，需要我们定义聚类别的数目，也就是参数K。举个例子，如下图所示，我们希望将数据聚为2个类别，图中最终结果呈现2个颜色，也就是2个类别。结合下图，可以简单地描述下Kmeans算法。

1. 首先，需要输入参数K值，也就是需要我们确定将数据聚为几个类别，我们这边确定输入K=2, 然后随机从数据中选择2个点，这2个点作为2个类别的中心；
2. 然后，对剩下的没有被选择的点分别计算到这2个中心点的距离，这些点距离哪个中心点近，我们就把它分到那个类别中；
3. 最后，回到第1步，重新选择中心的位置，并计算其它点到这2个中心点的距离并判断最近距离的类别，直到距离小于某个阈值或者中心点不再变化时，结束算法并输出聚类结果。
   ![img](https://ae01.alicdn.com/kf/U099184b8de964723b2fd0400fe7889e6w.jpg)

根据上面的例子，总结Kmeans算法步骤如下：

1.确定K值，从样本中随机选取K个对象作为初始的样本中心
2.计算每个样本到各聚类中心的距离，将对象分配到距离最近的聚类中心中
3.所有对象分配完成后，计算所有对象到其对应的聚类中心的距离总和
4.重新选择样本中心，计算按照新样本中心聚类的距离总和
5.与上次计算得到的结果对比，选择距离总和较小的分类结果
6.当距离总和不再减少或者样本中心不再变化时停止更新，输出聚类结果
![kmeans4](https://ae01.alicdn.com/kf/U2414770a20bb485d956c1da3391ba00ex.jpg)

### 4.2 Kmeans算法应用场景

**目标用户的群体分类**：
通过对特定运营目的和商业目的所挑选出的指标变量进行聚类分析，把目标群体划分成几个具有明显特征区别的细分群体，从而可以在运营活动中为这些细分群体采取精细化，个性化的运营和服务，最终提升运营的效率和商业效果（如把付费用户按照几个特定维度，如利润贡献，用户年龄，续费次数等聚类分析后得到不同特征的群体）
![聚类分析应用2](https://ae01.alicdn.com/kf/Uf9d10678b6eb49aca11aade69fa5470cV.jpg)

### 4.3 Kmeans算法实践



```
X = np.array([[1,2],[1,3],[1,0],[1,1],[3,1],[2,3],[4,1],[3,1],[4,3],[4,0]])
```

## 5.关联分析

大家听说过啤酒、婴儿尿布的故事吧？说的是全球零售业巨头沃尔玛在对消费者购物行为分析时发现，男性顾客在购买婴儿尿片时，常常会顺便搭配几瓶啤酒来犒劳自己，于是尝试推出了将啤酒和尿布摆在一起的促销手段。没想到这个举措居然使尿布和啤酒的销量都大幅增加了。这个故事说的就是关联分析。
![啤酒纸尿裤](https://ae01.alicdn.com/kf/U5b366ef69aa74664b0e6506cc2cb23c0I.jpg)

再讲个离我们生活非常贴近的例子。大家日常生活中说衣服穿搭，哪些衣服该和哪些裙子、哪些裤子搭在一起，这其实也是关联分析。
![衣服搭配](https://ae01.alicdn.com/kf/Ub268a2688ca34279a9ef6275bc02fb50C.jpg)

**关联分析**：发现隐藏在大型数据集下有意义的联系。
![购物车](https://ae01.alicdn.com/kf/U7c0f8f77afd043c19a88623ac14c84e2x.jpg)
![关联分析概念定义](https://ae01.alicdn.com/kf/Ucd8ec3346469453d928022ac20c7e3f62.jpg)

#### 基本概念：

1. **支持度计数**：项X，Y同时出现的次数。上表中{牛奶，燕麦片}的支持度计数为5。
2. **支持度**：项X,Y同时出现的次数/事务库的事务总数，上表中{牛奶，燕麦片}的支持度为5/10=0.5。
3. **置信度计数**：项Y在项X出现的事务中出现的次数，上表{牛奶，燕麦片}中，燕麦片在牛奶出现的事务中出现的次数为为5。
4. **置信度**：项Y在项X出现的事务置信度=(X,Y)的置信度计数/项X出现的次数，如{牛奶,燕麦}的置信度为5/7=0.71

关联分析算法：Apriori算法、FP-growth算法

### 5.1 Apriori算法

Apriori算法：

1. 第一步，寻找频繁项集。假设我们有了如下左图的购物订单数据，先统计项为1候选项集的支持度，设定频繁项集的最小支持度为0.5，因此把项为1候选项集中支持度大于0.5的项集选出来，有{啤酒}、{牛奶}、{燕麦片}，组合成项为2的候选项集并统计支持度，把项为2候选项集中支持度大于0.5的选出来，有{牛奶，燕麦片}。将项为2候选项集和项为1候选项集中的支持度大于0.5的项集组合成项为3的候选项集，并统计其支持度，即，{牛奶，燕麦片，啤酒}的支持度为0.2，不满足，因此，频繁项集为{牛奶，燕麦片}。
   ![寻找频繁项集](https://ae01.alicdn.com/kf/U6643e80298c74c2186fc23adcba68445R.jpg)
2. 第二步，计算置信度。利用置信度计算公式，如下所示：
   ![置信度计算公式](https://ae01.alicdn.com/kf/U1bc6cae0e1834d95bc09206c66adca1ca.jpg)

置信度的计算公式与条件概率计算公式相似，可以理解为：A事件发生后再发生B事件的概率等于AB事件同时发生的次数除以A事件发生的次数。根据公式计算得到牛奶与燕麦片的置信度
![置信度2](https://ae01.alicdn.com/kf/U37b75cffa8a0461088001c46fe96acbdF.jpg)

用户同时购买牛奶和燕麦片的概率是60%，在购买牛奶后，有87.5%的概率会再购买燕麦片。在购买燕麦片后，有100%的概率会购买牛奶。

### 5.2 Apriori算法应用场景

在商场中，根据客户购物订单数据，分析客户经常同时购买哪些商品，设置商品的销售套餐来实现交叉销售；
![购物应用](https://ae01.alicdn.com/kf/Ude9901e3503f4c6ebfe49cfd507f16648.jpg)

新闻推荐中，根据用户历史浏览数据，分析用户浏览了哪些内容后会再浏览哪些内容，来实现用户的内容推荐。

```
data = [['啤酒', '面包'], ['啤酒', '牛奶', '饼干'],['啤酒','牛奶','燕麦片'],
        ['啤酒', '薯片','瓜子'], [ '牛奶','薯片', '燕麦片'],['牛奶','面包','瓜子','燕麦片'],
        ['牛奶','饼干', '燕麦片'], ['面包','啤酒', '牛奶', '燕麦片'],['啤酒','瓜子','苹果'],['苹果','牛奶','燕麦片','饼干']]
```

### 5.3 Apriori算法实践

```
X = np.array([[1,1.2],[1.2,1.5],[1.5,1.4],[1.6,1.5],[1.92,1.5],[3.2,1.7],[4.3,1.6],[3.5,1.5],[3.8,1.2],[4.2,1.3]])
y = np.array([1,1,1,1,1,2,2,2,2,2])
test_X = np.array([[2.2,1.5],[3.1,1.6]])
test_y = np.array([1,2])
```